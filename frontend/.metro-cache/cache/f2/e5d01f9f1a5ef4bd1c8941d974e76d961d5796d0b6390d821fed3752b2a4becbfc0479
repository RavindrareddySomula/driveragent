{"dependencies":[{"name":"./is-binary.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":23,"index":164},"end":{"line":4,"column":48,"index":189}}],"key":"Aape7T+/x9esXlwptjKF8c3XaF4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.reconstructPacket = exports.deconstructPacket = void 0;\n  const is_binary_js_1 = require(_dependencyMap[0], \"./is-binary.js\");\n  /**\n   * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n   *\n   * @param {Object} packet - socket.io event packet\n   * @return {Object} with deconstructed packet and list of buffers\n   * @public\n   */\n  function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return {\n      packet: pack,\n      buffers: buffers\n    };\n  }\n  exports.deconstructPacket = deconstructPacket;\n  function _deconstructPacket(data, buffers) {\n    if (!data) return data;\n    if ((0, is_binary_js_1.isBinary)(data)) {\n      const placeholder = {\n        _placeholder: true,\n        num: buffers.length\n      };\n      buffers.push(data);\n      return placeholder;\n    } else if (Array.isArray(data)) {\n      const newData = new Array(data.length);\n      for (let i = 0; i < data.length; i++) {\n        newData[i] = _deconstructPacket(data[i], buffers);\n      }\n      return newData;\n    } else if (typeof data === \"object\" && !(data instanceof Date)) {\n      const newData = {};\n      for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n          newData[key] = _deconstructPacket(data[key], buffers);\n        }\n      }\n      return newData;\n    }\n    return data;\n  }\n  /**\n   * Reconstructs a binary packet from its placeholder packet and buffers\n   *\n   * @param {Object} packet - event packet with placeholders\n   * @param {Array} buffers - binary buffers to put in placeholder positions\n   * @return {Object} reconstructed packet\n   * @public\n   */\n  function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n  }\n  exports.reconstructPacket = reconstructPacket;\n  function _reconstructPacket(data, buffers) {\n    if (!data) return data;\n    if (data && data._placeholder === true) {\n      const isIndexValid = typeof data.num === \"number\" && data.num >= 0 && data.num < buffers.length;\n      if (isIndexValid) {\n        return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n      } else {\n        throw new Error(\"illegal attachments\");\n      }\n    } else if (Array.isArray(data)) {\n      for (let i = 0; i < data.length; i++) {\n        data[i] = _reconstructPacket(data[i], buffers);\n      }\n    } else if (typeof data === \"object\") {\n      for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n          data[key] = _reconstructPacket(data[key], buffers);\n        }\n      }\n    }\n    return data;\n  }\n});","lineCount":90,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"reconstructPacket"],[7,27,3,25],[7,30,3,28,"exports"],[7,37,3,35],[7,38,3,36,"deconstructPacket"],[7,55,3,53],[7,58,3,56],[7,63,3,61],[7,64,3,62],[8,2,4,0],[8,8,4,6,"is_binary_js_1"],[8,22,4,20],[8,25,4,23,"require"],[8,32,4,30],[8,33,4,30,"_dependencyMap"],[8,47,4,30],[8,68,4,47],[8,69,4,48],[9,2,5,0],[10,0,6,0],[11,0,7,0],[12,0,8,0],[13,0,9,0],[14,0,10,0],[15,0,11,0],[16,2,12,0],[16,11,12,9,"deconstructPacket"],[16,28,12,26,"deconstructPacket"],[16,29,12,27,"packet"],[16,35,12,33],[16,37,12,35],[17,4,13,4],[17,10,13,10,"buffers"],[17,17,13,17],[17,20,13,20],[17,22,13,22],[18,4,14,4],[18,10,14,10,"packetData"],[18,20,14,20],[18,23,14,23,"packet"],[18,29,14,29],[18,30,14,30,"data"],[18,34,14,34],[19,4,15,4],[19,10,15,10,"pack"],[19,14,15,14],[19,17,15,17,"packet"],[19,23,15,23],[20,4,16,4,"pack"],[20,8,16,8],[20,9,16,9,"data"],[20,13,16,13],[20,16,16,16,"_deconstructPacket"],[20,34,16,34],[20,35,16,35,"packetData"],[20,45,16,45],[20,47,16,47,"buffers"],[20,54,16,54],[20,55,16,55],[21,4,17,4,"pack"],[21,8,17,8],[21,9,17,9,"attachments"],[21,20,17,20],[21,23,17,23,"buffers"],[21,30,17,30],[21,31,17,31,"length"],[21,37,17,37],[21,38,17,38],[21,39,17,39],[22,4,18,4],[22,11,18,11],[23,6,18,13,"packet"],[23,12,18,19],[23,14,18,21,"pack"],[23,18,18,25],[24,6,18,27,"buffers"],[24,13,18,34],[24,15,18,36,"buffers"],[25,4,18,44],[25,5,18,45],[26,2,19,0],[27,2,20,0,"exports"],[27,9,20,7],[27,10,20,8,"deconstructPacket"],[27,27,20,25],[27,30,20,28,"deconstructPacket"],[27,47,20,45],[28,2,21,0],[28,11,21,9,"_deconstructPacket"],[28,29,21,27,"_deconstructPacket"],[28,30,21,28,"data"],[28,34,21,32],[28,36,21,34,"buffers"],[28,43,21,41],[28,45,21,43],[29,4,22,4],[29,8,22,8],[29,9,22,9,"data"],[29,13,22,13],[29,15,23,8],[29,22,23,15,"data"],[29,26,23,19],[30,4,24,4],[30,8,24,8],[30,9,24,9],[30,10,24,10],[30,12,24,12,"is_binary_js_1"],[30,26,24,26],[30,27,24,27,"isBinary"],[30,35,24,35],[30,37,24,37,"data"],[30,41,24,41],[30,42,24,42],[30,44,24,44],[31,6,25,8],[31,12,25,14,"placeholder"],[31,23,25,25],[31,26,25,28],[32,8,25,30,"_placeholder"],[32,20,25,42],[32,22,25,44],[32,26,25,48],[33,8,25,50,"num"],[33,11,25,53],[33,13,25,55,"buffers"],[33,20,25,62],[33,21,25,63,"length"],[34,6,25,70],[34,7,25,71],[35,6,26,8,"buffers"],[35,13,26,15],[35,14,26,16,"push"],[35,18,26,20],[35,19,26,21,"data"],[35,23,26,25],[35,24,26,26],[36,6,27,8],[36,13,27,15,"placeholder"],[36,24,27,26],[37,4,28,4],[37,5,28,5],[37,11,29,9],[37,15,29,13,"Array"],[37,20,29,18],[37,21,29,19,"isArray"],[37,28,29,26],[37,29,29,27,"data"],[37,33,29,31],[37,34,29,32],[37,36,29,34],[38,6,30,8],[38,12,30,14,"newData"],[38,19,30,21],[38,22,30,24],[38,26,30,28,"Array"],[38,31,30,33],[38,32,30,34,"data"],[38,36,30,38],[38,37,30,39,"length"],[38,43,30,45],[38,44,30,46],[39,6,31,8],[39,11,31,13],[39,15,31,17,"i"],[39,16,31,18],[39,19,31,21],[39,20,31,22],[39,22,31,24,"i"],[39,23,31,25],[39,26,31,28,"data"],[39,30,31,32],[39,31,31,33,"length"],[39,37,31,39],[39,39,31,41,"i"],[39,40,31,42],[39,42,31,44],[39,44,31,46],[40,8,32,12,"newData"],[40,15,32,19],[40,16,32,20,"i"],[40,17,32,21],[40,18,32,22],[40,21,32,25,"_deconstructPacket"],[40,39,32,43],[40,40,32,44,"data"],[40,44,32,48],[40,45,32,49,"i"],[40,46,32,50],[40,47,32,51],[40,49,32,53,"buffers"],[40,56,32,60],[40,57,32,61],[41,6,33,8],[42,6,34,8],[42,13,34,15,"newData"],[42,20,34,22],[43,4,35,4],[43,5,35,5],[43,11,36,9],[43,15,36,13],[43,22,36,20,"data"],[43,26,36,24],[43,31,36,29],[43,39,36,37],[43,43,36,41],[43,45,36,43,"data"],[43,49,36,47],[43,61,36,59,"Date"],[43,65,36,63],[43,66,36,64],[43,68,36,66],[44,6,37,8],[44,12,37,14,"newData"],[44,19,37,21],[44,22,37,24],[44,23,37,25],[44,24,37,26],[45,6,38,8],[45,11,38,13],[45,17,38,19,"key"],[45,20,38,22],[45,24,38,26,"data"],[45,28,38,30],[45,30,38,32],[46,8,39,12],[46,12,39,16,"Object"],[46,18,39,22],[46,19,39,23,"prototype"],[46,28,39,32],[46,29,39,33,"hasOwnProperty"],[46,43,39,47],[46,44,39,48,"call"],[46,48,39,52],[46,49,39,53,"data"],[46,53,39,57],[46,55,39,59,"key"],[46,58,39,62],[46,59,39,63],[46,61,39,65],[47,10,40,16,"newData"],[47,17,40,23],[47,18,40,24,"key"],[47,21,40,27],[47,22,40,28],[47,25,40,31,"_deconstructPacket"],[47,43,40,49],[47,44,40,50,"data"],[47,48,40,54],[47,49,40,55,"key"],[47,52,40,58],[47,53,40,59],[47,55,40,61,"buffers"],[47,62,40,68],[47,63,40,69],[48,8,41,12],[49,6,42,8],[50,6,43,8],[50,13,43,15,"newData"],[50,20,43,22],[51,4,44,4],[52,4,45,4],[52,11,45,11,"data"],[52,15,45,15],[53,2,46,0],[54,2,47,0],[55,0,48,0],[56,0,49,0],[57,0,50,0],[58,0,51,0],[59,0,52,0],[60,0,53,0],[61,0,54,0],[62,2,55,0],[62,11,55,9,"reconstructPacket"],[62,28,55,26,"reconstructPacket"],[62,29,55,27,"packet"],[62,35,55,33],[62,37,55,35,"buffers"],[62,44,55,42],[62,46,55,44],[63,4,56,4,"packet"],[63,10,56,10],[63,11,56,11,"data"],[63,15,56,15],[63,18,56,18,"_reconstructPacket"],[63,36,56,36],[63,37,56,37,"packet"],[63,43,56,43],[63,44,56,44,"data"],[63,48,56,48],[63,50,56,50,"buffers"],[63,57,56,57],[63,58,56,58],[64,4,57,4],[64,11,57,11,"packet"],[64,17,57,17],[64,18,57,18,"attachments"],[64,29,57,29],[64,30,57,30],[64,31,57,31],[65,4,58,4],[65,11,58,11,"packet"],[65,17,58,17],[66,2,59,0],[67,2,60,0,"exports"],[67,9,60,7],[67,10,60,8,"reconstructPacket"],[67,27,60,25],[67,30,60,28,"reconstructPacket"],[67,47,60,45],[68,2,61,0],[68,11,61,9,"_reconstructPacket"],[68,29,61,27,"_reconstructPacket"],[68,30,61,28,"data"],[68,34,61,32],[68,36,61,34,"buffers"],[68,43,61,41],[68,45,61,43],[69,4,62,4],[69,8,62,8],[69,9,62,9,"data"],[69,13,62,13],[69,15,63,8],[69,22,63,15,"data"],[69,26,63,19],[70,4,64,4],[70,8,64,8,"data"],[70,12,64,12],[70,16,64,16,"data"],[70,20,64,20],[70,21,64,21,"_placeholder"],[70,33,64,33],[70,38,64,38],[70,42,64,42],[70,44,64,44],[71,6,65,8],[71,12,65,14,"isIndexValid"],[71,24,65,26],[71,27,65,29],[71,34,65,36,"data"],[71,38,65,40],[71,39,65,41,"num"],[71,42,65,44],[71,47,65,49],[71,55,65,57],[71,59,66,12,"data"],[71,63,66,16],[71,64,66,17,"num"],[71,67,66,20],[71,71,66,24],[71,72,66,25],[71,76,67,12,"data"],[71,80,67,16],[71,81,67,17,"num"],[71,84,67,20],[71,87,67,23,"buffers"],[71,94,67,30],[71,95,67,31,"length"],[71,101,67,37],[72,6,68,8],[72,10,68,12,"isIndexValid"],[72,22,68,24],[72,24,68,26],[73,8,69,12],[73,15,69,19,"buffers"],[73,22,69,26],[73,23,69,27,"data"],[73,27,69,31],[73,28,69,32,"num"],[73,31,69,35],[73,32,69,36],[73,33,69,37],[73,34,69,38],[74,6,70,8],[74,7,70,9],[74,13,71,13],[75,8,72,12],[75,14,72,18],[75,18,72,22,"Error"],[75,23,72,27],[75,24,72,28],[75,45,72,49],[75,46,72,50],[76,6,73,8],[77,4,74,4],[77,5,74,5],[77,11,75,9],[77,15,75,13,"Array"],[77,20,75,18],[77,21,75,19,"isArray"],[77,28,75,26],[77,29,75,27,"data"],[77,33,75,31],[77,34,75,32],[77,36,75,34],[78,6,76,8],[78,11,76,13],[78,15,76,17,"i"],[78,16,76,18],[78,19,76,21],[78,20,76,22],[78,22,76,24,"i"],[78,23,76,25],[78,26,76,28,"data"],[78,30,76,32],[78,31,76,33,"length"],[78,37,76,39],[78,39,76,41,"i"],[78,40,76,42],[78,42,76,44],[78,44,76,46],[79,8,77,12,"data"],[79,12,77,16],[79,13,77,17,"i"],[79,14,77,18],[79,15,77,19],[79,18,77,22,"_reconstructPacket"],[79,36,77,40],[79,37,77,41,"data"],[79,41,77,45],[79,42,77,46,"i"],[79,43,77,47],[79,44,77,48],[79,46,77,50,"buffers"],[79,53,77,57],[79,54,77,58],[80,6,78,8],[81,4,79,4],[81,5,79,5],[81,11,80,9],[81,15,80,13],[81,22,80,20,"data"],[81,26,80,24],[81,31,80,29],[81,39,80,37],[81,41,80,39],[82,6,81,8],[82,11,81,13],[82,17,81,19,"key"],[82,20,81,22],[82,24,81,26,"data"],[82,28,81,30],[82,30,81,32],[83,8,82,12],[83,12,82,16,"Object"],[83,18,82,22],[83,19,82,23,"prototype"],[83,28,82,32],[83,29,82,33,"hasOwnProperty"],[83,43,82,47],[83,44,82,48,"call"],[83,48,82,52],[83,49,82,53,"data"],[83,53,82,57],[83,55,82,59,"key"],[83,58,82,62],[83,59,82,63],[83,61,82,65],[84,10,83,16,"data"],[84,14,83,20],[84,15,83,21,"key"],[84,18,83,24],[84,19,83,25],[84,22,83,28,"_reconstructPacket"],[84,40,83,46],[84,41,83,47,"data"],[84,45,83,51],[84,46,83,52,"key"],[84,49,83,55],[84,50,83,56],[84,52,83,58,"buffers"],[84,59,83,65],[84,60,83,66],[85,8,84,12],[86,6,85,8],[87,4,86,4],[88,4,87,4],[88,11,87,11,"data"],[88,15,87,15],[89,2,88,0],[90,0,88,1],[90,3]],"functionMap":{"names":["<global>","deconstructPacket","_deconstructPacket","reconstructPacket","_reconstructPacket"],"mappings":"AAA;ACW;CDO;AEE;CFyB;AGS;CHI;AIE;CJ2B"},"hasCjsExports":true},"type":"js/module"}]}